<div class="container">
  <h1>Mes information personnelles</h1>
  <button (click)="testConsole()">Console</button>
  <form class="data" [formGroup]="userForm">
    <div class="form-group">
      <label for="nom"
        >Nom<i class="fa-solid fa-circle-info fa-xs"></i> :</label
      >
      <input
        id="nom"
        [readOnly]="!updating"
        name="nom"
        type="text"
        placeholder="ex: Doe"
        formControlName="nom"
      />
      <div class="error" *ngIf="updating && form['nom'].errors">
        <span *ngIf="form['nom'].hasError('minlength')"
          >Votre nom doit faire au moins 3 caractères</span
        >
        <span *ngIf="form['nom'].hasError('required')"
          >Un nom est nécessaire</span
        >
      </div>
    </div>
    <div class="form-group">
      <label for="prenom">Prénom :</label>
      <input
        id="prenom"
        name="prenom"
        formControlName="prenom"
        [readOnly]="!updating"
        type="text"
        placeholder="ex: John"
      />
      <div class="error" *ngIf="updating && form['prenom'].errors">
        <span *ngIf="form['prenom'].hasError('minlength')"
          >Votre prenom doit faire au moins 3 caractères</span
        >
        <span *ngIf="form['prenom'].hasError('required')"
          >Un prenom est nécessaire</span
        >
      </div>
    </div>
    <div class="form-group">
      <label for="pseudo">Pseudo :</label>
      <input
        formControlName="pseudo"
        id="pseudo"
        name="pseudo"
        [readOnly]="!updating"
        type="text"
        placeholder="ex: JoeRoegan68"
      />
      <div class="error" *ngIf="updating && form['pseudo'].errors">
        <span *ngIf="form['pseudo'].hasError('minlength')"
          >Votre pseudo doit faire au moins 3 caractères</span
        >
        <span *ngIf="form['pseudo'].hasError('required')"
          >Un pseudo est nécessaire</span
        >
      </div>
    </div>
    <div class="form-group">
      <fieldset>
        <legend>
          Votre civilité<i class="fa-solid fa-circle-info fa-xs"></i> :
        </legend>

        <div class="flex">
          <input
            required
            type="radio"
            id="femme"
            name="civilite"
            [readOnly]="!updating"
            value="f"
            [checked]="user.civilite === 'f'"
          />
          <label for="femme">Femme</label>
        </div>
        <div class="flex">
          <input
            type="radio"
            [readOnly]="!updating"
            id="homme"
            name="civilite"
            value="m"
            [checked]="user.civilite === 'm'"
          />
          <label for="homme">Homme</label>
        </div>
      </fieldset>
    </div>
    <div class="form-group">
      <label for="email">Email :</label>
      <input
        formControlName="email"
        id="email"
        [readOnly]="!updating"
        name="email"
        type="email"
        placeholder="ex: john.doe@gmail.com"
      />
      <div class="error" *ngIf="updating && form['email'].errors">
        <span *ngIf="form['email'].hasError('email')"
          >Le format d'email devrait plutôt ressembler à :
          john.doe@gmail.com</span
        >
        <span *ngIf="form['email'].hasError('required')"
          >Une adresse email est nécessaire</span
        >
      </div>
    </div>
    <div class="form-group">
      <label for="telephone">Téléphone (facultatif) :</label>
      <input
        formControlName="telephone"
        id="telephone"
        name="telephone"
        [readOnly]="!updating"
        type="tel"
        placeholder="ex: +33 6 68 53 17 07"
      />
      <div class="error" *ngIf="updating && form['telephone'].errors">
        <span
          >Votre numéro de téléphone devrait ressembler à : +33 6 68 53 17
          07</span
        >
      </div>
    </div>
    <div class="success-msg" *ngIf="successMsg">
      <span>{{ successMsg }}</span>
    </div>
    <div class="error-msg" *ngIf="failureMsg">
      <span>{{ failureMsg }}</span>
    </div>
    <div class="btn-container">
      <button
        [ngClass]="updating ? 'updating' : ''"
        class="submit"
        (click)="updateInfos()"
        [disabled]="updating && !userForm.valid"
      >
        <span>{{ message }}</span>
      </button>
      <button (click)="cancel()" style="background: red" *ngIf="updating">
        Annuler
      </button>
    </div>
  </form>

  <!-- ICI 2E FORMULAIRE CHANGEMENT MDP -->
  <button *ngIf="!passwordChange" (click)="passwordChange = true">
    Changer de mot de passe
  </button>
  <div *ngIf="passwordChangeMsg">
    <span [ngClass]="passwordChangeMsg.status ? 'success-msg' : 'error-msg'">{{
      passwordChangeMsg.message
    }}</span>
  </div>

  <form *ngIf="passwordChange" class="password" [formGroup]="passwordForm">
    <div class="form-group">
      <label for="password">Mot de passe :</label>
      <input
        formControlName="password"
        id="password"
        name="password"
        type="{{ showPassword1 ? 'text' : 'password' }}"
        placeholder="Minimum de 8 caractères, 1 majuscule et 1 chiffre"
      /><i
        class="fa fa-eye"
        [ngClass]="{ 'fa-eye-slash': showPassword1 }"
        (click)="showPassword1 = !showPassword1"
      ></i>
      <div
        class="error"
        *ngIf="submitted && submittedGood && passForm['password'].errors"
      >
        <span *ngIf="passForm['password'].hasError('passwordPattern')"
          >Votre mot de passe fait un minimum de 8 caractères, avec 1 majuscule
          et 1 chiffre</span
        >
        <span *ngIf="passForm['password'].hasError('required')"
          >Une mot de passe est nécessaire</span
        >
      </div>
    </div>
    <div formGroupName="newpasswordForm">
      <div class="form-group">
        <label for="newPassword"
          >Nouveau mot de passe<i class="fa-solid fa-circle-info fa-xs"></i>
          :</label
        >
        <input
          formControlName="newPassword"
          id="newPassword"
          name="newPassword"
          type="{{ showPassword2 ? 'text' : 'password' }}"
          placeholder="Minimum de 8 caractères, 1 majuscule et 1 chiffre"
        />
        <i
          class="fa fa-eye"
          [ngClass]="{ 'fa-eye-slash': showPassword2 }"
          (click)="showPassword2 = !showPassword2"
        ></i>
        <div
          class="error"
          *ngIf="
            submitted && submittedGood && newpassword['newPassword'].errors
          "
        >
          <span *ngIf="newpassword['newPassword'].hasError('passwordPattern')"
            >Votre nouveau mot de passe doit faire un minimum de 8 caractères,
            avec 1 majuscule et 1 chiffre</span
          >
          <span *ngIf="newpassword['newPassword'].hasError('required')"
            >Un nouveau mot de passe est nécessaire</span
          >
        </div>
      </div>
      <div class="form-group">
        <label for="confirmNewPassword"
          >Confimer le nouveau mot de passe :</label
        >
        <input
          formControlName="confirmNewPassword"
          id="confirmNewPassword"
          name="confirmNewPassword"
          type="{{ showPassword3 ? 'text' : 'password' }}"
          placeholder="Minimum de 8 caractères, 1 majuscule et 1 chiffre"
        />
        <i
          class="fa fa-eye"
          [ngClass]="{ 'fa-eye-slash': showPassword3 }"
          (click)="showPassword3 = !showPassword3"
        ></i>
        <div
          class="error"
          *ngIf="
            newpassword['newPassword'].touched &&
            newpassword['confirmNewPassword'].errors
          "
        >
          <span>Les mots de passe doivent être identiques</span>
        </div>
      </div>
    </div>
    <div class="buttons">
      <button (click)="cancelPasswordChange()">Annuler</button>
      <button (click)="confirmPasswordChange()">Confirmer le changement</button>
    </div>
  </form>
</div>
